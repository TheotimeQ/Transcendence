"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var _lib_auth_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/auth/auth */ \"(middleware)/./src/lib/auth/auth.ts\");\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/../../node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var _services_Lobby_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./services/Lobby.service */ \"(middleware)/./src/services/Lobby.service.ts\");\n\n\n\nasync function middleware(req) {\n    let crunchyToken = req.cookies.get(\"crunchy-token\")?.value;\n    let refreshToken = req.cookies.get(\"refresh-token\")?.value;\n    let changeCookies = false;\n    let verifiedToken = crunchyToken && await (0,_lib_auth_auth__WEBPACK_IMPORTED_MODULE_0__.verifyAuth)(crunchyToken).catch((err)=>{\n        console.log(err);\n    });\n    // const url = req.nextUrl;\n    // console.log(verifiedToken, url);\n    if (verifiedToken && req.nextUrl.pathname === \"/home/auth/google\") {\n        // console.log(\"do nothing go to google\");\n        return;\n    }\n    if (verifiedToken && verifiedToken.twoFactorAuth && req.nextUrl.pathname !== \"/home/auth/2fa\") {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/auth/2fa\", req.url));\n    }\n    // refresh token if token expires in less than 10 minutes\n    if (req.nextUrl.pathname.startsWith(\"/home\") && refreshToken) {\n        const currentTimestamp = Math.floor(Date.now() / 1000);\n        if (!verifiedToken || verifiedToken && verifiedToken.exp - currentTimestamp < 300) {\n            try {\n                const res = await fetch(`http://backend:4000/api/auth/refresh`, {\n                    method: \"POST\",\n                    headers: {\n                        Authorization: \"Bearer \" + crunchyToken,\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify({\n                        refreshToken: refreshToken\n                    })\n                });\n                if (!res.ok) throw new Error(\"error fetch refresh token\");\n                const data = await res.json();\n                crunchyToken = data.access_token;\n                refreshToken = data.refresh_token;\n                changeCookies = true;\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    }\n    if (verifiedToken && verifiedToken.login && req.nextUrl.pathname === \"/home/create\") {\n        // console.log(\"redirect go to home\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (verifiedToken && !verifiedToken.login && req.nextUrl.pathname.startsWith(\"/home\") && req.nextUrl.pathname !== \"/home/create\") {\n        // console.log(\"redkirect go create\");\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/create\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname === \"/\" && !verifiedToken && !changeCookies) {\n        // console.log(\"redirect go to welcome\")\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/welcome\", req.url));\n    }\n    if (req.nextUrl.pathname === \"/\" && (verifiedToken || changeCookies)) {\n        // console.log(\"redirect go to home from /\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname.startsWith(\"/welcome\") && (verifiedToken || changeCookies)) {\n        // console.log(\"redirect go to home from /welcome\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname.startsWith(\"/home\") && !verifiedToken && !changeCookies) {\n        // console.log(\"redirect go to welcome from /home\")\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/welcome/notif\", req.url));\n    }\n    // console.log(\"nothing redirected\");\n    // Check if user is in a multiplayer game and redirect to page\n    if (req.nextUrl.pathname.startsWith(\"/home\") && (verifiedToken || changeCookies) && !req.nextUrl.pathname.startsWith(\"/home/game\")) {\n        console.log(\"check if user is in game\");\n        const lobbyService = new _services_Lobby_service__WEBPACK_IMPORTED_MODULE_2__[\"default\"](crunchyToken);\n        await lobbyService.isInGame().then((ret)=>{\n            if (ret.success) {\n                console.log(\"redirect to game\");\n                const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/game/\" + ret.data, req.url));\n                if (changeCookies && refreshToken) {\n                    response.cookies.set(\"crunchy-token\", crunchyToken, {\n                        httpOnly: true,\n                        sameSite: \"strict\",\n                        path: \"/\"\n                    });\n                    response.cookies.set(\"refresh-token\", refreshToken, {\n                        httpOnly: true,\n                        sameSite: \"strict\",\n                        path: \"/\"\n                    });\n                }\n                return response;\n            }\n        });\n    }\n    if (changeCookies && refreshToken) {\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].next();\n        response.cookies.set(\"crunchy-token\", crunchyToken, {\n            httpOnly: true,\n            sameSite: \"strict\",\n            path: \"/\"\n        });\n        response.cookies.set(\"refresh-token\", refreshToken, {\n            httpOnly: true,\n            sameSite: \"strict\",\n            path: \"/\"\n        });\n        return response;\n    }\n}\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except for the ones starting with:\n     * - icon, images\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */ \"/((?!api|icon|images|_next/static|_next/image|favicon.ico).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ekMsY0FBd0I7d0JBQzVEMEMsVUFBVTt3QkFDVkMsVUFBVTt3QkFDVkMsTUFBTTtvQkFDUjtvQkFDQUosU0FBU3ZDLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxpQkFBaUJyQyxjQUFjO3dCQUNsRHNDLFVBQVU7d0JBQ1ZDLFVBQVU7d0JBQ1ZDLE1BQU07b0JBQ1I7Z0JBQ0Y7Z0JBQ0EsT0FBT0o7WUFDVDtRQUNGO0lBQ0Y7SUFFQSxJQUFJbkMsaUJBQWlCRCxjQUFjO1FBQ2pDLE1BQU1vQyxXQUFXNUMsa0ZBQVlBLENBQUNzRCxJQUFJO1FBQ2xDVixTQUFTdkMsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLGlCQUFpQnpDLGNBQXdCO1lBQzVEMEMsVUFBVTtZQUNWQyxVQUFVO1lBQ1ZDLE1BQU07UUFDUjtRQUNBSixTQUFTdkMsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLGlCQUFpQnJDLGNBQWM7WUFDbERzQyxVQUFVO1lBQ1ZDLFVBQVU7WUFDVkMsTUFBTTtRQUNSO1FBQ0EsT0FBT0o7SUFDVDtBQUNGO0FBRU8sTUFBTVcsU0FBUztJQUNwQkMsU0FBUztRQUNQOzs7Ozs7O0tBT0MsR0FDRDtLQUNEO0FBQ0gsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9zcmMvbWlkZGxld2FyZS50cz9kMTk5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHZlcmlmeUF1dGggfSBmcm9tIFwiQC9saWIvYXV0aC9hdXRoXCI7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgTG9iYnlTZXJ2aWNlIGZyb20gXCIuL3NlcnZpY2VzL0xvYmJ5LnNlcnZpY2VcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxOiBOZXh0UmVxdWVzdCkge1xuICBsZXQgY3J1bmNoeVRva2VuID0gcmVxLmNvb2tpZXMuZ2V0KFwiY3J1bmNoeS10b2tlblwiKT8udmFsdWU7XG4gIGxldCByZWZyZXNoVG9rZW4gPSByZXEuY29va2llcy5nZXQoXCJyZWZyZXNoLXRva2VuXCIpPy52YWx1ZTtcbiAgbGV0IGNoYW5nZUNvb2tpZXMgPSBmYWxzZTtcblxuICBsZXQgdmVyaWZpZWRUb2tlbiA9XG4gICAgY3J1bmNoeVRva2VuICYmXG4gICAgKGF3YWl0IHZlcmlmeUF1dGgoY3J1bmNoeVRva2VuKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pKTtcbiAgLy8gY29uc3QgdXJsID0gcmVxLm5leHRVcmw7XG4gIC8vIGNvbnNvbGUubG9nKHZlcmlmaWVkVG9rZW4sIHVybCk7XG5cbiAgaWYgKHZlcmlmaWVkVG9rZW4gJiYgcmVxLm5leHRVcmwucGF0aG5hbWUgPT09IFwiL2hvbWUvYXV0aC9nb29nbGVcIikge1xuICAgIC8vIGNvbnNvbGUubG9nKFwiZG8gbm90aGluZyBnbyB0byBnb29nbGVcIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKFxuICAgIHZlcmlmaWVkVG9rZW4gJiZcbiAgICB2ZXJpZmllZFRva2VuLnR3b0ZhY3RvckF1dGggJiZcbiAgICByZXEubmV4dFVybC5wYXRobmFtZSAhPT0gXCIvaG9tZS9hdXRoLzJmYVwiXG4gICkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9ob21lL2F1dGgvMmZhXCIsIHJlcS51cmwpKTtcbiAgfVxuXG4gIC8vIHJlZnJlc2ggdG9rZW4gaWYgdG9rZW4gZXhwaXJlcyBpbiBsZXNzIHRoYW4gMTAgbWludXRlc1xuICBpZiAocmVxLm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChcIi9ob21lXCIpICYmIHJlZnJlc2hUb2tlbikge1xuICAgIGNvbnN0IGN1cnJlbnRUaW1lc3RhbXAgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcblxuICAgIGlmIChcbiAgICAgICF2ZXJpZmllZFRva2VuIHx8XG4gICAgICAodmVyaWZpZWRUb2tlbiAmJiB2ZXJpZmllZFRva2VuLmV4cCEgLSBjdXJyZW50VGltZXN0YW1wIDwgMzAwKVxuICAgICkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly9iYWNrZW5kOjQwMDAvYXBpL2F1dGgvcmVmcmVzaGAsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IFwiQmVhcmVyIFwiICsgY3J1bmNoeVRva2VuLFxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IHJlZnJlc2hUb2tlbixcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcihcImVycm9yIGZldGNoIHJlZnJlc2ggdG9rZW5cIik7XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgICAgIGNydW5jaHlUb2tlbiA9IGRhdGEuYWNjZXNzX3Rva2VuO1xuICAgICAgICByZWZyZXNoVG9rZW4gPSBkYXRhLnJlZnJlc2hfdG9rZW47XG4gICAgICAgIGNoYW5nZUNvb2tpZXMgPSB0cnVlO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChcbiAgICB2ZXJpZmllZFRva2VuICYmXG4gICAgdmVyaWZpZWRUb2tlbi5sb2dpbiAmJlxuICAgIHJlcS5uZXh0VXJsLnBhdGhuYW1lID09PSBcIi9ob21lL2NyZWF0ZVwiXG4gICkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwicmVkaXJlY3QgZ28gdG8gaG9tZVwiKVxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvaG9tZVwiLCByZXEudXJsKSk7XG4gICAgaWYgKGNoYW5nZUNvb2tpZXMgJiYgcmVmcmVzaFRva2VuKSB7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcImNydW5jaHktdG9rZW5cIiwgY3J1bmNoeVRva2VuIGFzIHN0cmluZywge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcInJlZnJlc2gtdG9rZW5cIiwgcmVmcmVzaFRva2VuLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgaWYgKFxuICAgIHZlcmlmaWVkVG9rZW4gJiZcbiAgICAhdmVyaWZpZWRUb2tlbi5sb2dpbiAmJlxuICAgIHJlcS5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaG9tZVwiKSAmJlxuICAgIHJlcS5uZXh0VXJsLnBhdGhuYW1lICE9PSBcIi9ob21lL2NyZWF0ZVwiXG4gICkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwicmVka2lyZWN0IGdvIGNyZWF0ZVwiKTtcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL2hvbWUvY3JlYXRlXCIsIHJlcS51cmwpKTtcbiAgICBpZiAoY2hhbmdlQ29va2llcyAmJiByZWZyZXNoVG9rZW4pIHtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwiY3J1bmNoeS10b2tlblwiLCBjcnVuY2h5VG9rZW4gYXMgc3RyaW5nLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwicmVmcmVzaC10b2tlblwiLCByZWZyZXNoVG9rZW4sIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICBpZiAocmVxLm5leHRVcmwucGF0aG5hbWUgPT09IFwiL1wiICYmICF2ZXJpZmllZFRva2VuICYmICFjaGFuZ2VDb29raWVzKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJyZWRpcmVjdCBnbyB0byB3ZWxjb21lXCIpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL3dlbGNvbWVcIiwgcmVxLnVybCkpO1xuICB9XG5cbiAgaWYgKHJlcS5uZXh0VXJsLnBhdGhuYW1lID09PSBcIi9cIiAmJiAodmVyaWZpZWRUb2tlbiB8fCBjaGFuZ2VDb29raWVzKSkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwicmVkaXJlY3QgZ28gdG8gaG9tZSBmcm9tIC9cIilcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL2hvbWVcIiwgcmVxLnVybCkpO1xuICAgIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJjcnVuY2h5LXRva2VuXCIsIGNydW5jaHlUb2tlbiBhcyBzdHJpbmcsIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJyZWZyZXNoLXRva2VuXCIsIHJlZnJlc2hUb2tlbiwge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIGlmIChcbiAgICByZXEubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKFwiL3dlbGNvbWVcIikgJiZcbiAgICAodmVyaWZpZWRUb2tlbiB8fCBjaGFuZ2VDb29raWVzKVxuICApIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlZGlyZWN0IGdvIHRvIGhvbWUgZnJvbSAvd2VsY29tZVwiKVxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9ob21lXCIsIHJlcS51cmwpKTtcbiAgICBpZiAoY2hhbmdlQ29va2llcyAmJiByZWZyZXNoVG9rZW4pIHtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwiY3J1bmNoeS10b2tlblwiLCBjcnVuY2h5VG9rZW4gYXMgc3RyaW5nLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwicmVmcmVzaC10b2tlblwiLCByZWZyZXNoVG9rZW4sIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICBpZiAoXG4gICAgcmVxLm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChcIi9ob21lXCIpICYmXG4gICAgIXZlcmlmaWVkVG9rZW4gJiZcbiAgICAhY2hhbmdlQ29va2llc1xuICApIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlZGlyZWN0IGdvIHRvIHdlbGNvbWUgZnJvbSAvaG9tZVwiKVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL3dlbGNvbWUvbm90aWZcIiwgcmVxLnVybCkpO1xuICB9XG5cbiAgLy8gY29uc29sZS5sb2coXCJub3RoaW5nIHJlZGlyZWN0ZWRcIik7XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBpcyBpbiBhIG11bHRpcGxheWVyIGdhbWUgYW5kIHJlZGlyZWN0IHRvIHBhZ2VcbiAgaWYgKFxuICAgIHJlcS5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaG9tZVwiKSAmJlxuICAgICh2ZXJpZmllZFRva2VuIHx8IGNoYW5nZUNvb2tpZXMpICYmXG4gICAgIXJlcS5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaG9tZS9nYW1lXCIpXG4gICkge1xuICAgIGNvbnNvbGUubG9nKFwiY2hlY2sgaWYgdXNlciBpcyBpbiBnYW1lXCIpO1xuICAgIGNvbnN0IGxvYmJ5U2VydmljZSA9IG5ldyBMb2JieVNlcnZpY2UoY3J1bmNoeVRva2VuKTtcbiAgICBhd2FpdCBsb2JieVNlcnZpY2UuaXNJbkdhbWUoKS50aGVuKChyZXQ6IFJldHVybkRhdGEpID0+IHtcbiAgICAgIGlmIChyZXQuc3VjY2Vzcykge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlZGlyZWN0IHRvIGdhbWVcIik7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KFxuICAgICAgICAgIG5ldyBVUkwoXCIvaG9tZS9nYW1lL1wiICsgcmV0LmRhdGEsIHJlcS51cmwpXG4gICAgICAgICk7XG4gICAgICAgIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgICAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwiY3J1bmNoeS10b2tlblwiLCBjcnVuY2h5VG9rZW4gYXMgc3RyaW5nLCB7XG4gICAgICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJyZWZyZXNoLXRva2VuXCIsIHJlZnJlc2hUb2tlbiwge1xuICAgICAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgICByZXNwb25zZS5jb29raWVzLnNldChcImNydW5jaHktdG9rZW5cIiwgY3J1bmNoeVRva2VuIGFzIHN0cmluZywge1xuICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgIHBhdGg6IFwiL1wiLFxuICAgIH0pO1xuICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwicmVmcmVzaC10b2tlblwiLCByZWZyZXNoVG9rZW4sIHtcbiAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICBwYXRoOiBcIi9cIixcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgbWF0Y2hlcjogW1xuICAgIC8qXG4gICAgICogTWF0Y2ggYWxsIHJlcXVlc3QgcGF0aHMgZXhjZXB0IGZvciB0aGUgb25lcyBzdGFydGluZyB3aXRoOlxuICAgICAqIC0gaWNvbiwgaW1hZ2VzXG4gICAgICogLSBhcGkgKEFQSSByb3V0ZXMpXG4gICAgICogLSBfbmV4dC9zdGF0aWMgKHN0YXRpYyBmaWxlcylcbiAgICAgKiAtIF9uZXh0L2ltYWdlIChpbWFnZSBvcHRpbWl6YXRpb24gZmlsZXMpXG4gICAgICogLSBmYXZpY29uLmljbyAoZmF2aWNvbiBmaWxlKVxuICAgICAqL1xuICAgIFwiLygoPyFhcGl8aWNvbnxpbWFnZXN8X25leHQvc3RhdGljfF9uZXh0L2ltYWdlfGZhdmljb24uaWNvKS4qKVwiLFxuICBdLFxufTtcbiJdLCJuYW1lcyI6WyJ2ZXJpZnlBdXRoIiwiTmV4dFJlc3BvbnNlIiwiTG9iYnlTZXJ2aWNlIiwibWlkZGxld2FyZSIsInJlcSIsImNydW5jaHlUb2tlbiIsImNvb2tpZXMiLCJnZXQiLCJ2YWx1ZSIsInJlZnJlc2hUb2tlbiIsImNoYW5nZUNvb2tpZXMiLCJ2ZXJpZmllZFRva2VuIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwibmV4dFVybCIsInBhdGhuYW1lIiwidHdvRmFjdG9yQXV0aCIsInJlZGlyZWN0IiwiVVJMIiwidXJsIiwic3RhcnRzV2l0aCIsImN1cnJlbnRUaW1lc3RhbXAiLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwibm93IiwiZXhwIiwicmVzIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJFcnJvciIsImRhdGEiLCJqc29uIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsImVycm9yIiwibG9naW4iLCJyZXNwb25zZSIsInNldCIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJwYXRoIiwibG9iYnlTZXJ2aWNlIiwiaXNJbkdhbWUiLCJ0aGVuIiwicmV0Iiwic3VjY2VzcyIsIm5leHQiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});