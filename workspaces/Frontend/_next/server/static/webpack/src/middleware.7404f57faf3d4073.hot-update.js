"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var _lib_auth_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/auth/auth */ \"(middleware)/./src/lib/auth/auth.ts\");\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/../../node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var _services_Lobby_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./services/Lobby.service */ \"(middleware)/./src/services/Lobby.service.ts\");\n\n\n\nasync function middleware(req) {\n    let crunchyToken = req.cookies.get(\"crunchy-token\")?.value;\n    let refreshToken = req.cookies.get(\"refresh-token\")?.value;\n    let changeCookies = false;\n    let verifiedToken = crunchyToken && await (0,_lib_auth_auth__WEBPACK_IMPORTED_MODULE_0__.verifyAuth)(crunchyToken).catch((err)=>{\n        console.log(err);\n    });\n    // const url = req.nextUrl;\n    // console.log(verifiedToken, url);\n    if (verifiedToken && req.nextUrl.pathname === \"/home/auth/google\") {\n        // console.log(\"do nothing go to google\");\n        return;\n    }\n    if (verifiedToken && verifiedToken.twoFactorAuth && req.nextUrl.pathname !== \"/home/auth/2fa\") {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/auth/2fa\", req.url));\n    }\n    // refresh token if token expires in less than 10 minutes\n    if (req.nextUrl.pathname.startsWith(\"/home\") && refreshToken) {\n        const currentTimestamp = Math.floor(Date.now() / 1000);\n        if (!verifiedToken || verifiedToken && verifiedToken.exp - currentTimestamp < 300) {\n            try {\n                const res = await fetch(`http://backend:4000/api/auth/refresh`, {\n                    method: \"POST\",\n                    headers: {\n                        Authorization: \"Bearer \" + crunchyToken,\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify({\n                        refreshToken: refreshToken\n                    })\n                });\n                if (!res.ok) throw new Error(\"error fetch refresh token\");\n                const data = await res.json();\n                crunchyToken = data.access_token;\n                refreshToken = data.refresh_token;\n                changeCookies = true;\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    }\n    if (verifiedToken && verifiedToken.login && req.nextUrl.pathname === \"/home/create\") {\n        // console.log(\"redirect go to home\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (verifiedToken && !verifiedToken.login && req.nextUrl.pathname.startsWith(\"/home\") && req.nextUrl.pathname !== \"/home/create\") {\n        // console.log(\"redkirect go create\");\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/create\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname === \"/\" && !verifiedToken && !changeCookies) {\n        // console.log(\"redirect go to welcome\")\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/welcome\", req.url));\n    }\n    if (req.nextUrl.pathname === \"/\" && (verifiedToken || changeCookies)) {\n        // console.log(\"redirect go to home from /\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname.startsWith(\"/welcome\") && (verifiedToken || changeCookies)) {\n        // console.log(\"redirect go to home from /welcome\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname.startsWith(\"/home\") && !verifiedToken && !changeCookies) {\n        // console.log(\"redirect go to welcome from /home\")\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/welcome/notif\", req.url));\n    }\n    // console.log(\"nothing redirected\");\n    // Check if user is in a multiplayer game and redirect to page\n    if (req.nextUrl.pathname.startsWith(\"/home\") && (verifiedToken || changeCookies) && !req.nextUrl.pathname.startsWith(\"/home/game\")) {\n        console.log(\"check if user is in game\");\n        const lobbyService = new _services_Lobby_service__WEBPACK_IMPORTED_MODULE_2__[\"default\"](crunchyToken);\n        await lobbyService.isInGame().then((ret)=>{\n            if (ret.success) {\n                const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/game/\" + ret.data, req.url));\n                if (changeCookies && refreshToken) {\n                    response.cookies.set(\"crunchy-token\", crunchyToken, {\n                        httpOnly: true,\n                        sameSite: \"strict\",\n                        path: \"/\"\n                    });\n                    response.cookies.set(\"refresh-token\", refreshToken, {\n                        httpOnly: true,\n                        sameSite: \"strict\",\n                        path: \"/\"\n                    });\n                }\n                return response;\n            }\n        });\n    }\n    if (changeCookies && refreshToken) {\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].next();\n        response.cookies.set(\"crunchy-token\", crunchyToken, {\n            httpOnly: true,\n            sameSite: \"strict\",\n            path: \"/\"\n        });\n        response.cookies.set(\"refresh-token\", refreshToken, {\n            httpOnly: true,\n            sameSite: \"strict\",\n            path: \"/\"\n        });\n        return response;\n    }\n}\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except for the ones starting with:\n     * - icon, images\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */ \"/((?!api|icon|images|_next/static|_next/image|favicon.ico).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL21pZGRsZXdhcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBNkM7QUFDVztBQUNKO0FBRTdDLGVBQWVHLFdBQVdDLEdBQWdCO0lBQy9DLElBQUlDLGVBQWVELElBQUlFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGtCQUFrQkM7SUFDckQsSUFBSUMsZUFBZUwsSUFBSUUsT0FBTyxDQUFDQyxHQUFHLENBQUMsa0JBQWtCQztJQUNyRCxJQUFJRSxnQkFBZ0I7SUFFcEIsSUFBSUMsZ0JBQ0ZOLGdCQUNDLE1BQU1MLDBEQUFVQSxDQUFDSyxjQUFjTyxLQUFLLENBQUMsQ0FBQ0M7UUFDckNDLFFBQVFDLEdBQUcsQ0FBQ0Y7SUFDZDtJQUNGLDJCQUEyQjtJQUMzQixtQ0FBbUM7SUFFbkMsSUFBSUYsaUJBQWlCUCxJQUFJWSxPQUFPLENBQUNDLFFBQVEsS0FBSyxxQkFBcUI7UUFDakUsMENBQTBDO1FBQzFDO0lBQ0Y7SUFFQSxJQUNFTixpQkFDQUEsY0FBY08sYUFBYSxJQUMzQmQsSUFBSVksT0FBTyxDQUFDQyxRQUFRLEtBQUssa0JBQ3pCO1FBQ0EsT0FBT2hCLGtGQUFZQSxDQUFDa0IsUUFBUSxDQUFDLElBQUlDLElBQUksa0JBQWtCaEIsSUFBSWlCLEdBQUc7SUFDaEU7SUFFQSx5REFBeUQ7SUFDekQsSUFBSWpCLElBQUlZLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDSyxVQUFVLENBQUMsWUFBWWIsY0FBYztRQUM1RCxNQUFNYyxtQkFBbUJDLEtBQUtDLEtBQUssQ0FBQ0MsS0FBS0MsR0FBRyxLQUFLO1FBRWpELElBQ0UsQ0FBQ2hCLGlCQUNBQSxpQkFBaUJBLGNBQWNpQixHQUFHLEdBQUlMLG1CQUFtQixLQUMxRDtZQUNBLElBQUk7Z0JBQ0YsTUFBTU0sTUFBTSxNQUFNQyxNQUFNLENBQUMsb0NBQW9DLENBQUMsRUFBRTtvQkFDOURDLFFBQVE7b0JBQ1JDLFNBQVM7d0JBQ1BDLGVBQWUsWUFBWTVCO3dCQUMzQixnQkFBZ0I7b0JBQ2xCO29CQUNBNkIsTUFBTUMsS0FBS0MsU0FBUyxDQUFDO3dCQUNuQjNCLGNBQWNBO29CQUNoQjtnQkFDRjtnQkFFQSxJQUFJLENBQUNvQixJQUFJUSxFQUFFLEVBQUUsTUFBTSxJQUFJQyxNQUFNO2dCQUU3QixNQUFNQyxPQUFPLE1BQU1WLElBQUlXLElBQUk7Z0JBQzNCbkMsZUFBZWtDLEtBQUtFLFlBQVk7Z0JBQ2hDaEMsZUFBZThCLEtBQUtHLGFBQWE7Z0JBQ2pDaEMsZ0JBQWdCO1lBQ2xCLEVBQUUsT0FBT2lDLE9BQU87Z0JBQ2Q3QixRQUFRQyxHQUFHLENBQUM0QjtZQUNkO1FBQ0Y7SUFDRjtJQUVBLElBQ0VoQyxpQkFDQUEsY0FBY2lDLEtBQUssSUFDbkJ4QyxJQUFJWSxPQUFPLENBQUNDLFFBQVEsS0FBSyxnQkFDekI7UUFDQSxxQ0FBcUM7UUFDckMsTUFBTTRCLFdBQVc1QyxrRkFBWUEsQ0FBQ2tCLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLFNBQVNoQixJQUFJaUIsR0FBRztRQUMvRCxJQUFJWCxpQkFBaUJELGNBQWM7WUFDakNvQyxTQUFTdkMsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLGlCQUFpQnpDLGNBQXdCO2dCQUM1RDBDLFVBQVU7Z0JBQ1ZDLFVBQVU7Z0JBQ1ZDLE1BQU07WUFDUjtZQUNBSixTQUFTdkMsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLGlCQUFpQnJDLGNBQWM7Z0JBQ2xEc0MsVUFBVTtnQkFDVkMsVUFBVTtnQkFDVkMsTUFBTTtZQUNSO1FBQ0Y7UUFDQSxPQUFPSjtJQUNUO0lBRUEsSUFDRWxDLGlCQUNBLENBQUNBLGNBQWNpQyxLQUFLLElBQ3BCeEMsSUFBSVksT0FBTyxDQUFDQyxRQUFRLENBQUNLLFVBQVUsQ0FBQyxZQUNoQ2xCLElBQUlZLE9BQU8sQ0FBQ0MsUUFBUSxLQUFLLGdCQUN6QjtRQUNBLHNDQUFzQztRQUN0QyxNQUFNNEIsV0FBVzVDLGtGQUFZQSxDQUFDa0IsUUFBUSxDQUFDLElBQUlDLElBQUksZ0JBQWdCaEIsSUFBSWlCLEdBQUc7UUFDdEUsSUFBSVgsaUJBQWlCRCxjQUFjO1lBQ2pDb0MsU0FBU3ZDLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxpQkFBaUJ6QyxjQUF3QjtnQkFDNUQwQyxVQUFVO2dCQUNWQyxVQUFVO2dCQUNWQyxNQUFNO1lBQ1I7WUFDQUosU0FBU3ZDLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxpQkFBaUJyQyxjQUFjO2dCQUNsRHNDLFVBQVU7Z0JBQ1ZDLFVBQVU7Z0JBQ1ZDLE1BQU07WUFDUjtRQUNGO1FBQ0EsT0FBT0o7SUFDVDtJQUVBLElBQUl6QyxJQUFJWSxPQUFPLENBQUNDLFFBQVEsS0FBSyxPQUFPLENBQUNOLGlCQUFpQixDQUFDRCxlQUFlO1FBQ3BFLHdDQUF3QztRQUN4QyxPQUFPVCxrRkFBWUEsQ0FBQ2tCLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLFlBQVloQixJQUFJaUIsR0FBRztJQUMxRDtJQUVBLElBQUlqQixJQUFJWSxPQUFPLENBQUNDLFFBQVEsS0FBSyxPQUFRTixDQUFBQSxpQkFBaUJELGFBQVksR0FBSTtRQUNwRSw0Q0FBNEM7UUFDNUMsTUFBTW1DLFdBQVc1QyxrRkFBWUEsQ0FBQ2tCLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLFNBQVNoQixJQUFJaUIsR0FBRztRQUMvRCxJQUFJWCxpQkFBaUJELGNBQWM7WUFDakNvQyxTQUFTdkMsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLGlCQUFpQnpDLGNBQXdCO2dCQUM1RDBDLFVBQVU7Z0JBQ1ZDLFVBQVU7Z0JBQ1ZDLE1BQU07WUFDUjtZQUNBSixTQUFTdkMsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLGlCQUFpQnJDLGNBQWM7Z0JBQ2xEc0MsVUFBVTtnQkFDVkMsVUFBVTtnQkFDVkMsTUFBTTtZQUNSO1FBQ0Y7UUFDQSxPQUFPSjtJQUNUO0lBRUEsSUFDRXpDLElBQUlZLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDSyxVQUFVLENBQUMsZUFDL0JYLENBQUFBLGlCQUFpQkQsYUFBWSxHQUM5QjtRQUNBLG1EQUFtRDtRQUVuRCxNQUFNbUMsV0FBVzVDLGtGQUFZQSxDQUFDa0IsUUFBUSxDQUFDLElBQUlDLElBQUksU0FBU2hCLElBQUlpQixHQUFHO1FBQy9ELElBQUlYLGlCQUFpQkQsY0FBYztZQUNqQ29DLFNBQVN2QyxPQUFPLENBQUN3QyxHQUFHLENBQUMsaUJBQWlCekMsY0FBd0I7Z0JBQzVEMEMsVUFBVTtnQkFDVkMsVUFBVTtnQkFDVkMsTUFBTTtZQUNSO1lBQ0FKLFNBQVN2QyxPQUFPLENBQUN3QyxHQUFHLENBQUMsaUJBQWlCckMsY0FBYztnQkFDbERzQyxVQUFVO2dCQUNWQyxVQUFVO2dCQUNWQyxNQUFNO1lBQ1I7UUFDRjtRQUNBLE9BQU9KO0lBQ1Q7SUFFQSxJQUNFekMsSUFBSVksT0FBTyxDQUFDQyxRQUFRLENBQUNLLFVBQVUsQ0FBQyxZQUNoQyxDQUFDWCxpQkFDRCxDQUFDRCxlQUNEO1FBQ0EsbURBQW1EO1FBRW5ELE9BQU9ULGtGQUFZQSxDQUFDa0IsUUFBUSxDQUFDLElBQUlDLElBQUksa0JBQWtCaEIsSUFBSWlCLEdBQUc7SUFDaEU7SUFFQSxxQ0FBcUM7SUFFckMsOERBQThEO0lBQzlELElBQ0VqQixJQUFJWSxPQUFPLENBQUNDLFFBQVEsQ0FBQ0ssVUFBVSxDQUFDLFlBQy9CWCxDQUFBQSxpQkFBaUJELGFBQVksS0FDOUIsQ0FBQ04sSUFBSVksT0FBTyxDQUFDQyxRQUFRLENBQUNLLFVBQVUsQ0FBQyxlQUNqQztRQUNBUixRQUFRQyxHQUFHLENBQUM7UUFDWixNQUFNbUMsZUFBZSxJQUFJaEQsK0RBQVlBLENBQUNHO1FBQ3RDLE1BQU02QyxhQUFhQyxRQUFRLEdBQUdDLElBQUksQ0FBQyxDQUFDQztZQUNsQyxJQUFJQSxJQUFJQyxPQUFPLEVBQUU7Z0JBQ2YsTUFBTVQsV0FBVzVDLGtGQUFZQSxDQUFDa0IsUUFBUSxDQUNwQyxJQUFJQyxJQUFJLGdCQUFnQmlDLElBQUlkLElBQUksRUFBRW5DLElBQUlpQixHQUFHO2dCQUUzQyxJQUFJWCxpQkFBaUJELGNBQWM7b0JBQ2pDb0MsU0FBU3ZDLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxpQkFBaUJ6QyxjQUF3Qjt3QkFDNUQwQyxVQUFVO3dCQUNWQyxVQUFVO3dCQUNWQyxNQUFNO29CQUNSO29CQUNBSixTQUFTdkMsT0FBTyxDQUFDd0MsR0FBRyxDQUFDLGlCQUFpQnJDLGNBQWM7d0JBQ2xEc0MsVUFBVTt3QkFDVkMsVUFBVTt3QkFDVkMsTUFBTTtvQkFDUjtnQkFDRjtnQkFDQSxPQUFPSjtZQUNUO1FBQ0Y7SUFDRjtJQUVBLElBQUluQyxpQkFBaUJELGNBQWM7UUFDakMsTUFBTW9DLFdBQVc1QyxrRkFBWUEsQ0FBQ3NELElBQUk7UUFDbENWLFNBQVN2QyxPQUFPLENBQUN3QyxHQUFHLENBQUMsaUJBQWlCekMsY0FBd0I7WUFDNUQwQyxVQUFVO1lBQ1ZDLFVBQVU7WUFDVkMsTUFBTTtRQUNSO1FBQ0FKLFNBQVN2QyxPQUFPLENBQUN3QyxHQUFHLENBQUMsaUJBQWlCckMsY0FBYztZQUNsRHNDLFVBQVU7WUFDVkMsVUFBVTtZQUNWQyxNQUFNO1FBQ1I7UUFDQSxPQUFPSjtJQUNUO0FBQ0Y7QUFFTyxNQUFNVyxTQUFTO0lBQ3BCQyxTQUFTO1FBQ1A7Ozs7Ozs7S0FPQyxHQUNEO0tBQ0Q7QUFDSCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9taWRkbGV3YXJlLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdmVyaWZ5QXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoL2F1dGhcIjtcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCBMb2JieVNlcnZpY2UgZnJvbSBcIi4vc2VydmljZXMvTG9iYnkuc2VydmljZVwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGxldCBjcnVuY2h5VG9rZW4gPSByZXEuY29va2llcy5nZXQoXCJjcnVuY2h5LXRva2VuXCIpPy52YWx1ZTtcbiAgbGV0IHJlZnJlc2hUb2tlbiA9IHJlcS5jb29raWVzLmdldChcInJlZnJlc2gtdG9rZW5cIik/LnZhbHVlO1xuICBsZXQgY2hhbmdlQ29va2llcyA9IGZhbHNlO1xuXG4gIGxldCB2ZXJpZmllZFRva2VuID1cbiAgICBjcnVuY2h5VG9rZW4gJiZcbiAgICAoYXdhaXQgdmVyaWZ5QXV0aChjcnVuY2h5VG9rZW4pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSkpO1xuICAvLyBjb25zdCB1cmwgPSByZXEubmV4dFVybDtcbiAgLy8gY29uc29sZS5sb2codmVyaWZpZWRUb2tlbiwgdXJsKTtcblxuICBpZiAodmVyaWZpZWRUb2tlbiAmJiByZXEubmV4dFVybC5wYXRobmFtZSA9PT0gXCIvaG9tZS9hdXRoL2dvb2dsZVwiKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJkbyBub3RoaW5nIGdvIHRvIGdvb2dsZVwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoXG4gICAgdmVyaWZpZWRUb2tlbiAmJlxuICAgIHZlcmlmaWVkVG9rZW4udHdvRmFjdG9yQXV0aCAmJlxuICAgIHJlcS5uZXh0VXJsLnBhdGhuYW1lICE9PSBcIi9ob21lL2F1dGgvMmZhXCJcbiAgKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL2hvbWUvYXV0aC8yZmFcIiwgcmVxLnVybCkpO1xuICB9XG5cbiAgLy8gcmVmcmVzaCB0b2tlbiBpZiB0b2tlbiBleHBpcmVzIGluIGxlc3MgdGhhbiAxMCBtaW51dGVzXG4gIGlmIChyZXEubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKFwiL2hvbWVcIikgJiYgcmVmcmVzaFRva2VuKSB7XG4gICAgY29uc3QgY3VycmVudFRpbWVzdGFtcCA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApO1xuXG4gICAgaWYgKFxuICAgICAgIXZlcmlmaWVkVG9rZW4gfHxcbiAgICAgICh2ZXJpZmllZFRva2VuICYmIHZlcmlmaWVkVG9rZW4uZXhwISAtIGN1cnJlbnRUaW1lc3RhbXAgPCAzMDApXG4gICAgKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgaHR0cDovL2JhY2tlbmQ6NDAwMC9hcGkvYXV0aC9yZWZyZXNoYCwge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogXCJCZWFyZXIgXCIgKyBjcnVuY2h5VG9rZW4sXG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogcmVmcmVzaFRva2VuLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKFwiZXJyb3IgZmV0Y2ggcmVmcmVzaCB0b2tlblwiKTtcblxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICAgICAgY3J1bmNoeVRva2VuID0gZGF0YS5hY2Nlc3NfdG9rZW47XG4gICAgICAgIHJlZnJlc2hUb2tlbiA9IGRhdGEucmVmcmVzaF90b2tlbjtcbiAgICAgICAgY2hhbmdlQ29va2llcyA9IHRydWU7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKFxuICAgIHZlcmlmaWVkVG9rZW4gJiZcbiAgICB2ZXJpZmllZFRva2VuLmxvZ2luICYmXG4gICAgcmVxLm5leHRVcmwucGF0aG5hbWUgPT09IFwiL2hvbWUvY3JlYXRlXCJcbiAgKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJyZWRpcmVjdCBnbyB0byBob21lXCIpXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9ob21lXCIsIHJlcS51cmwpKTtcbiAgICBpZiAoY2hhbmdlQ29va2llcyAmJiByZWZyZXNoVG9rZW4pIHtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwiY3J1bmNoeS10b2tlblwiLCBjcnVuY2h5VG9rZW4gYXMgc3RyaW5nLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwicmVmcmVzaC10b2tlblwiLCByZWZyZXNoVG9rZW4sIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICBpZiAoXG4gICAgdmVyaWZpZWRUb2tlbiAmJlxuICAgICF2ZXJpZmllZFRva2VuLmxvZ2luICYmXG4gICAgcmVxLm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChcIi9ob21lXCIpICYmXG4gICAgcmVxLm5leHRVcmwucGF0aG5hbWUgIT09IFwiL2hvbWUvY3JlYXRlXCJcbiAgKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJyZWRraXJlY3QgZ28gY3JlYXRlXCIpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvaG9tZS9jcmVhdGVcIiwgcmVxLnVybCkpO1xuICAgIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJjcnVuY2h5LXRva2VuXCIsIGNydW5jaHlUb2tlbiBhcyBzdHJpbmcsIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJyZWZyZXNoLXRva2VuXCIsIHJlZnJlc2hUb2tlbiwge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIGlmIChyZXEubmV4dFVybC5wYXRobmFtZSA9PT0gXCIvXCIgJiYgIXZlcmlmaWVkVG9rZW4gJiYgIWNoYW5nZUNvb2tpZXMpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlZGlyZWN0IGdvIHRvIHdlbGNvbWVcIilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvd2VsY29tZVwiLCByZXEudXJsKSk7XG4gIH1cblxuICBpZiAocmVxLm5leHRVcmwucGF0aG5hbWUgPT09IFwiL1wiICYmICh2ZXJpZmllZFRva2VuIHx8IGNoYW5nZUNvb2tpZXMpKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJyZWRpcmVjdCBnbyB0byBob21lIGZyb20gL1wiKVxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvaG9tZVwiLCByZXEudXJsKSk7XG4gICAgaWYgKGNoYW5nZUNvb2tpZXMgJiYgcmVmcmVzaFRva2VuKSB7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcImNydW5jaHktdG9rZW5cIiwgY3J1bmNoeVRva2VuIGFzIHN0cmluZywge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcInJlZnJlc2gtdG9rZW5cIiwgcmVmcmVzaFRva2VuLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgaWYgKFxuICAgIHJlcS5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvd2VsY29tZVwiKSAmJlxuICAgICh2ZXJpZmllZFRva2VuIHx8IGNoYW5nZUNvb2tpZXMpXG4gICkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwicmVkaXJlY3QgZ28gdG8gaG9tZSBmcm9tIC93ZWxjb21lXCIpXG5cbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL2hvbWVcIiwgcmVxLnVybCkpO1xuICAgIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJjcnVuY2h5LXRva2VuXCIsIGNydW5jaHlUb2tlbiBhcyBzdHJpbmcsIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJyZWZyZXNoLXRva2VuXCIsIHJlZnJlc2hUb2tlbiwge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIGlmIChcbiAgICByZXEubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKFwiL2hvbWVcIikgJiZcbiAgICAhdmVyaWZpZWRUb2tlbiAmJlxuICAgICFjaGFuZ2VDb29raWVzXG4gICkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwicmVkaXJlY3QgZ28gdG8gd2VsY29tZSBmcm9tIC9ob21lXCIpXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvd2VsY29tZS9ub3RpZlwiLCByZXEudXJsKSk7XG4gIH1cblxuICAvLyBjb25zb2xlLmxvZyhcIm5vdGhpbmcgcmVkaXJlY3RlZFwiKTtcblxuICAvLyBDaGVjayBpZiB1c2VyIGlzIGluIGEgbXVsdGlwbGF5ZXIgZ2FtZSBhbmQgcmVkaXJlY3QgdG8gcGFnZVxuICBpZiAoXG4gICAgcmVxLm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChcIi9ob21lXCIpICYmXG4gICAgKHZlcmlmaWVkVG9rZW4gfHwgY2hhbmdlQ29va2llcykgJiZcbiAgICAhcmVxLm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChcIi9ob21lL2dhbWVcIilcbiAgKSB7XG4gICAgY29uc29sZS5sb2coXCJjaGVjayBpZiB1c2VyIGlzIGluIGdhbWVcIik7XG4gICAgY29uc3QgbG9iYnlTZXJ2aWNlID0gbmV3IExvYmJ5U2VydmljZShjcnVuY2h5VG9rZW4pO1xuICAgIGF3YWl0IGxvYmJ5U2VydmljZS5pc0luR2FtZSgpLnRoZW4oKHJldDogUmV0dXJuRGF0YSkgPT4ge1xuICAgICAgaWYgKHJldC5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KFxuICAgICAgICAgIG5ldyBVUkwoXCIvaG9tZS9nYW1lL1wiICsgcmV0LmRhdGEsIHJlcS51cmwpXG4gICAgICAgICk7XG4gICAgICAgIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgICAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwiY3J1bmNoeS10b2tlblwiLCBjcnVuY2h5VG9rZW4gYXMgc3RyaW5nLCB7XG4gICAgICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJyZWZyZXNoLXRva2VuXCIsIHJlZnJlc2hUb2tlbiwge1xuICAgICAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgICByZXNwb25zZS5jb29raWVzLnNldChcImNydW5jaHktdG9rZW5cIiwgY3J1bmNoeVRva2VuIGFzIHN0cmluZywge1xuICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgIHBhdGg6IFwiL1wiLFxuICAgIH0pO1xuICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwicmVmcmVzaC10b2tlblwiLCByZWZyZXNoVG9rZW4sIHtcbiAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICBwYXRoOiBcIi9cIixcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgbWF0Y2hlcjogW1xuICAgIC8qXG4gICAgICogTWF0Y2ggYWxsIHJlcXVlc3QgcGF0aHMgZXhjZXB0IGZvciB0aGUgb25lcyBzdGFydGluZyB3aXRoOlxuICAgICAqIC0gaWNvbiwgaW1hZ2VzXG4gICAgICogLSBhcGkgKEFQSSByb3V0ZXMpXG4gICAgICogLSBfbmV4dC9zdGF0aWMgKHN0YXRpYyBmaWxlcylcbiAgICAgKiAtIF9uZXh0L2ltYWdlIChpbWFnZSBvcHRpbWl6YXRpb24gZmlsZXMpXG4gICAgICogLSBmYXZpY29uLmljbyAoZmF2aWNvbiBmaWxlKVxuICAgICAqL1xuICAgIFwiLygoPyFhcGl8aWNvbnxpbWFnZXN8X25leHQvc3RhdGljfF9uZXh0L2ltYWdlfGZhdmljb24uaWNvKS4qKVwiLFxuICBdLFxufTtcbiJdLCJuYW1lcyI6WyJ2ZXJpZnlBdXRoIiwiTmV4dFJlc3BvbnNlIiwiTG9iYnlTZXJ2aWNlIiwibWlkZGxld2FyZSIsInJlcSIsImNydW5jaHlUb2tlbiIsImNvb2tpZXMiLCJnZXQiLCJ2YWx1ZSIsInJlZnJlc2hUb2tlbiIsImNoYW5nZUNvb2tpZXMiLCJ2ZXJpZmllZFRva2VuIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwibmV4dFVybCIsInBhdGhuYW1lIiwidHdvRmFjdG9yQXV0aCIsInJlZGlyZWN0IiwiVVJMIiwidXJsIiwic3RhcnRzV2l0aCIsImN1cnJlbnRUaW1lc3RhbXAiLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwibm93IiwiZXhwIiwicmVzIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJFcnJvciIsImRhdGEiLCJqc29uIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsImVycm9yIiwibG9naW4iLCJyZXNwb25zZSIsInNldCIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJwYXRoIiwibG9iYnlTZXJ2aWNlIiwiaXNJbkdhbWUiLCJ0aGVuIiwicmV0Iiwic3VjY2VzcyIsIm5leHQiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});