"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var _lib_auth_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/auth/auth */ \"(middleware)/./src/lib/auth/auth.ts\");\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/../../node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var _services_Lobby_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./services/Lobby.service */ \"(middleware)/./src/services/Lobby.service.ts\");\n\n\n\nasync function middleware(req) {\n    let crunchyToken = req.cookies.get(\"crunchy-token\")?.value;\n    let refreshToken = req.cookies.get(\"refresh-token\")?.value;\n    let changeCookies = false;\n    let verifiedToken = crunchyToken && await (0,_lib_auth_auth__WEBPACK_IMPORTED_MODULE_0__.verifyAuth)(crunchyToken).catch((err)=>{\n        console.log(err);\n    });\n    // const url = req.nextUrl;\n    // console.log(verifiedToken, url);\n    if (verifiedToken && req.nextUrl.pathname === \"/home/auth/google\") {\n        // console.log(\"do nothing go to google\");\n        return;\n    }\n    if (verifiedToken && verifiedToken.twoFactorAuth && req.nextUrl.pathname !== \"/home/auth/2fa\") {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/auth/2fa\", req.url));\n    }\n    // refresh token if token expires in less than 10 minutes\n    if (req.nextUrl.pathname.startsWith(\"/home\") && refreshToken) {\n        const currentTimestamp = Math.floor(Date.now() / 1000);\n        if (!verifiedToken || verifiedToken && verifiedToken.exp - currentTimestamp < 300) {\n            try {\n                const res = await fetch(`http://backend:4000/api/auth/refresh`, {\n                    method: \"POST\",\n                    headers: {\n                        Authorization: \"Bearer \" + crunchyToken,\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify({\n                        refreshToken: refreshToken\n                    })\n                });\n                if (!res.ok) throw new Error(\"error fetch refresh token\");\n                const data = await res.json();\n                crunchyToken = data.access_token;\n                refreshToken = data.refresh_token;\n                changeCookies = true;\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    }\n    if (verifiedToken && verifiedToken.login && req.nextUrl.pathname === \"/home/create\") {\n        // console.log(\"redirect go to home\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (verifiedToken && !verifiedToken.login && req.nextUrl.pathname.startsWith(\"/home\") && req.nextUrl.pathname !== \"/home/create\") {\n        // console.log(\"redkirect go create\");\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/create\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname === \"/\" && !verifiedToken && !changeCookies) {\n        // console.log(\"redirect go to welcome\")\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/welcome\", req.url));\n    }\n    if (req.nextUrl.pathname === \"/\" && (verifiedToken || changeCookies)) {\n        // console.log(\"redirect go to home from /\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname.startsWith(\"/welcome\") && (verifiedToken || changeCookies)) {\n        // console.log(\"redirect go to home from /welcome\")\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home\", req.url));\n        if (changeCookies && refreshToken) {\n            response.cookies.set(\"crunchy-token\", crunchyToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n            response.cookies.set(\"refresh-token\", refreshToken, {\n                httpOnly: true,\n                sameSite: \"strict\",\n                path: \"/\"\n            });\n        }\n        return response;\n    }\n    if (req.nextUrl.pathname.startsWith(\"/home\") && !verifiedToken && !changeCookies) {\n        // console.log(\"redirect go to welcome from /home\")\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/welcome/notif\", req.url));\n    }\n    // console.log(\"nothing redirected\");\n    // Check if user is in a multiplayer game and redirect to page\n    if (req.nextUrl.pathname.startsWith(\"/home\") && (verifiedToken || changeCookies) && !req.nextUrl.pathname.startsWith(\"/home/game\")) {\n        const lobbyService = new _services_Lobby_service__WEBPACK_IMPORTED_MODULE_2__[\"default\"](crunchyToken);\n        await lobbyService.isInGame().then((ret)=>{\n            if (ret.success) {\n                const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redirect(new URL(\"/home/game/\" + ret.data, req.url));\n                if (changeCookies && refreshToken) {\n                    response.cookies.set(\"crunchy-token\", crunchyToken, {\n                        httpOnly: true,\n                        sameSite: \"strict\",\n                        path: \"/\"\n                    });\n                    response.cookies.set(\"refresh-token\", refreshToken, {\n                        httpOnly: true,\n                        sameSite: \"strict\",\n                        path: \"/\"\n                    });\n                }\n                return response;\n            }\n        });\n    }\n    if (changeCookies && refreshToken) {\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].next();\n        response.cookies.set(\"crunchy-token\", crunchyToken, {\n            httpOnly: true,\n            sameSite: \"strict\",\n            path: \"/\"\n        });\n        response.cookies.set(\"refresh-token\", refreshToken, {\n            httpOnly: true,\n            sameSite: \"strict\",\n            path: \"/\"\n        });\n        return response;\n    }\n}\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except for the ones starting with:\n     * - icon, images\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */ \"/((?!api|icon|images|_next/static|_next/image|favicon.ico).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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b0JBQ1I7b0JBQ0FKLFNBQVN2QyxPQUFPLENBQUN3QyxHQUFHLENBQUMsaUJBQWlCckMsY0FBYzt3QkFDbERzQyxVQUFVO3dCQUNWQyxVQUFVO3dCQUNWQyxNQUFNO29CQUNSO2dCQUNGO2dCQUNBLE9BQU9KO1lBQ1Q7UUFDRjtJQUNGO0lBRUEsSUFBSW5DLGlCQUFpQkQsY0FBYztRQUNqQyxNQUFNb0MsV0FBVzVDLGtGQUFZQSxDQUFDc0QsSUFBSTtRQUNsQ1YsU0FBU3ZDLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxpQkFBaUJ6QyxjQUF3QjtZQUM1RDBDLFVBQVU7WUFDVkMsVUFBVTtZQUNWQyxNQUFNO1FBQ1I7UUFDQUosU0FBU3ZDLE9BQU8sQ0FBQ3dDLEdBQUcsQ0FBQyxpQkFBaUJyQyxjQUFjO1lBQ2xEc0MsVUFBVTtZQUNWQyxVQUFVO1lBQ1ZDLE1BQU07UUFDUjtRQUNBLE9BQU9KO0lBQ1Q7QUFDRjtBQUVPLE1BQU1XLFNBQVM7SUFDcEJDLFNBQVM7UUFDUDs7Ozs7OztLQU9DLEdBQ0Q7S0FDRDtBQUNILEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vc3JjL21pZGRsZXdhcmUudHM/ZDE5OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB2ZXJpZnlBdXRoIH0gZnJvbSBcIkAvbGliL2F1dGgvYXV0aFwiO1xuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IExvYmJ5U2VydmljZSBmcm9tIFwiLi9zZXJ2aWNlcy9Mb2JieS5zZXJ2aWNlXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgbGV0IGNydW5jaHlUb2tlbiA9IHJlcS5jb29raWVzLmdldChcImNydW5jaHktdG9rZW5cIik/LnZhbHVlO1xuICBsZXQgcmVmcmVzaFRva2VuID0gcmVxLmNvb2tpZXMuZ2V0KFwicmVmcmVzaC10b2tlblwiKT8udmFsdWU7XG4gIGxldCBjaGFuZ2VDb29raWVzID0gZmFsc2U7XG5cbiAgbGV0IHZlcmlmaWVkVG9rZW4gPVxuICAgIGNydW5jaHlUb2tlbiAmJlxuICAgIChhd2FpdCB2ZXJpZnlBdXRoKGNydW5jaHlUb2tlbikuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KSk7XG4gIC8vIGNvbnN0IHVybCA9IHJlcS5uZXh0VXJsO1xuICAvLyBjb25zb2xlLmxvZyh2ZXJpZmllZFRva2VuLCB1cmwpO1xuXG4gIGlmICh2ZXJpZmllZFRva2VuICYmIHJlcS5uZXh0VXJsLnBhdGhuYW1lID09PSBcIi9ob21lL2F1dGgvZ29vZ2xlXCIpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcImRvIG5vdGhpbmcgZ28gdG8gZ29vZ2xlXCIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChcbiAgICB2ZXJpZmllZFRva2VuICYmXG4gICAgdmVyaWZpZWRUb2tlbi50d29GYWN0b3JBdXRoICYmXG4gICAgcmVxLm5leHRVcmwucGF0aG5hbWUgIT09IFwiL2hvbWUvYXV0aC8yZmFcIlxuICApIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvaG9tZS9hdXRoLzJmYVwiLCByZXEudXJsKSk7XG4gIH1cblxuICAvLyByZWZyZXNoIHRva2VuIGlmIHRva2VuIGV4cGlyZXMgaW4gbGVzcyB0aGFuIDEwIG1pbnV0ZXNcbiAgaWYgKHJlcS5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaG9tZVwiKSAmJiByZWZyZXNoVG9rZW4pIHtcbiAgICBjb25zdCBjdXJyZW50VGltZXN0YW1wID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7XG5cbiAgICBpZiAoXG4gICAgICAhdmVyaWZpZWRUb2tlbiB8fFxuICAgICAgKHZlcmlmaWVkVG9rZW4gJiYgdmVyaWZpZWRUb2tlbi5leHAhIC0gY3VycmVudFRpbWVzdGFtcCA8IDMwMClcbiAgICApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGBodHRwOi8vYmFja2VuZDo0MDAwL2FwaS9hdXRoL3JlZnJlc2hgLCB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBcIkJlYXJlciBcIiArIGNydW5jaHlUb2tlbixcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgcmVmcmVzaFRva2VuOiByZWZyZXNoVG9rZW4sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoXCJlcnJvciBmZXRjaCByZWZyZXNoIHRva2VuXCIpO1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpO1xuICAgICAgICBjcnVuY2h5VG9rZW4gPSBkYXRhLmFjY2Vzc190b2tlbjtcbiAgICAgICAgcmVmcmVzaFRva2VuID0gZGF0YS5yZWZyZXNoX3Rva2VuO1xuICAgICAgICBjaGFuZ2VDb29raWVzID0gdHJ1ZTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoXG4gICAgdmVyaWZpZWRUb2tlbiAmJlxuICAgIHZlcmlmaWVkVG9rZW4ubG9naW4gJiZcbiAgICByZXEubmV4dFVybC5wYXRobmFtZSA9PT0gXCIvaG9tZS9jcmVhdGVcIlxuICApIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlZGlyZWN0IGdvIHRvIGhvbWVcIilcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL2hvbWVcIiwgcmVxLnVybCkpO1xuICAgIGlmIChjaGFuZ2VDb29raWVzICYmIHJlZnJlc2hUb2tlbikge1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJjcnVuY2h5LXRva2VuXCIsIGNydW5jaHlUb2tlbiBhcyBzdHJpbmcsIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJyZWZyZXNoLXRva2VuXCIsIHJlZnJlc2hUb2tlbiwge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIGlmIChcbiAgICB2ZXJpZmllZFRva2VuICYmXG4gICAgIXZlcmlmaWVkVG9rZW4ubG9naW4gJiZcbiAgICByZXEubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKFwiL2hvbWVcIikgJiZcbiAgICByZXEubmV4dFVybC5wYXRobmFtZSAhPT0gXCIvaG9tZS9jcmVhdGVcIlxuICApIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlZGtpcmVjdCBnbyBjcmVhdGVcIik7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9ob21lL2NyZWF0ZVwiLCByZXEudXJsKSk7XG4gICAgaWYgKGNoYW5nZUNvb2tpZXMgJiYgcmVmcmVzaFRva2VuKSB7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcImNydW5jaHktdG9rZW5cIiwgY3J1bmNoeVRva2VuIGFzIHN0cmluZywge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcInJlZnJlc2gtdG9rZW5cIiwgcmVmcmVzaFRva2VuLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgaWYgKHJlcS5uZXh0VXJsLnBhdGhuYW1lID09PSBcIi9cIiAmJiAhdmVyaWZpZWRUb2tlbiAmJiAhY2hhbmdlQ29va2llcykge1xuICAgIC8vIGNvbnNvbGUubG9nKFwicmVkaXJlY3QgZ28gdG8gd2VsY29tZVwiKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi93ZWxjb21lXCIsIHJlcS51cmwpKTtcbiAgfVxuXG4gIGlmIChyZXEubmV4dFVybC5wYXRobmFtZSA9PT0gXCIvXCIgJiYgKHZlcmlmaWVkVG9rZW4gfHwgY2hhbmdlQ29va2llcykpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcInJlZGlyZWN0IGdvIHRvIGhvbWUgZnJvbSAvXCIpXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9ob21lXCIsIHJlcS51cmwpKTtcbiAgICBpZiAoY2hhbmdlQ29va2llcyAmJiByZWZyZXNoVG9rZW4pIHtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwiY3J1bmNoeS10b2tlblwiLCBjcnVuY2h5VG9rZW4gYXMgc3RyaW5nLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwicmVmcmVzaC10b2tlblwiLCByZWZyZXNoVG9rZW4sIHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cblxuICBpZiAoXG4gICAgcmVxLm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aChcIi93ZWxjb21lXCIpICYmXG4gICAgKHZlcmlmaWVkVG9rZW4gfHwgY2hhbmdlQ29va2llcylcbiAgKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJyZWRpcmVjdCBnbyB0byBob21lIGZyb20gL3dlbGNvbWVcIilcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvaG9tZVwiLCByZXEudXJsKSk7XG4gICAgaWYgKGNoYW5nZUNvb2tpZXMgJiYgcmVmcmVzaFRva2VuKSB7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcImNydW5jaHktdG9rZW5cIiwgY3J1bmNoeVRva2VuIGFzIHN0cmluZywge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZS5jb29raWVzLnNldChcInJlZnJlc2gtdG9rZW5cIiwgcmVmcmVzaFRva2VuLCB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgaWYgKFxuICAgIHJlcS5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaG9tZVwiKSAmJlxuICAgICF2ZXJpZmllZFRva2VuICYmXG4gICAgIWNoYW5nZUNvb2tpZXNcbiAgKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJyZWRpcmVjdCBnbyB0byB3ZWxjb21lIGZyb20gL2hvbWVcIilcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi93ZWxjb21lL25vdGlmXCIsIHJlcS51cmwpKTtcbiAgfVxuXG4gIC8vIGNvbnNvbGUubG9nKFwibm90aGluZyByZWRpcmVjdGVkXCIpO1xuXG4gIC8vIENoZWNrIGlmIHVzZXIgaXMgaW4gYSBtdWx0aXBsYXllciBnYW1lIGFuZCByZWRpcmVjdCB0byBwYWdlXG4gIGlmIChcbiAgICByZXEubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKFwiL2hvbWVcIikgJiZcbiAgICAodmVyaWZpZWRUb2tlbiB8fCBjaGFuZ2VDb29raWVzKSAmJlxuICAgICFyZXEubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKFwiL2hvbWUvZ2FtZVwiKVxuICApIHtcbiAgICBjb25zdCBsb2JieVNlcnZpY2UgPSBuZXcgTG9iYnlTZXJ2aWNlKGNydW5jaHlUb2tlbik7XG4gICAgYXdhaXQgbG9iYnlTZXJ2aWNlLmlzSW5HYW1lKCkudGhlbigocmV0OiBSZXR1cm5EYXRhKSA9PiB7XG4gICAgICBpZiAocmV0LnN1Y2Nlc3MpIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QoXG4gICAgICAgICAgbmV3IFVSTChcIi9ob21lL2dhbWUvXCIgKyByZXQuZGF0YSwgcmVxLnVybClcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGNoYW5nZUNvb2tpZXMgJiYgcmVmcmVzaFRva2VuKSB7XG4gICAgICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJjcnVuY2h5LXRva2VuXCIsIGNydW5jaHlUb2tlbiBhcyBzdHJpbmcsIHtcbiAgICAgICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICAgICAgc2FtZVNpdGU6IFwic3RyaWN0XCIsXG4gICAgICAgICAgICBwYXRoOiBcIi9cIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXNwb25zZS5jb29raWVzLnNldChcInJlZnJlc2gtdG9rZW5cIiwgcmVmcmVzaFRva2VuLCB7XG4gICAgICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgICAgICAgcGF0aDogXCIvXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKGNoYW5nZUNvb2tpZXMgJiYgcmVmcmVzaFRva2VuKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xuICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KFwiY3J1bmNoeS10b2tlblwiLCBjcnVuY2h5VG9rZW4gYXMgc3RyaW5nLCB7XG4gICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgIHNhbWVTaXRlOiBcInN0cmljdFwiLFxuICAgICAgcGF0aDogXCIvXCIsXG4gICAgfSk7XG4gICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJyZWZyZXNoLXRva2VuXCIsIHJlZnJlc2hUb2tlbiwge1xuICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICBzYW1lU2l0ZTogXCJzdHJpY3RcIixcbiAgICAgIHBhdGg6IFwiL1wiLFxuICAgIH0pO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBtYXRjaGVyOiBbXG4gICAgLypcbiAgICAgKiBNYXRjaCBhbGwgcmVxdWVzdCBwYXRocyBleGNlcHQgZm9yIHRoZSBvbmVzIHN0YXJ0aW5nIHdpdGg6XG4gICAgICogLSBpY29uLCBpbWFnZXNcbiAgICAgKiAtIGFwaSAoQVBJIHJvdXRlcylcbiAgICAgKiAtIF9uZXh0L3N0YXRpYyAoc3RhdGljIGZpbGVzKVxuICAgICAqIC0gX25leHQvaW1hZ2UgKGltYWdlIG9wdGltaXphdGlvbiBmaWxlcylcbiAgICAgKiAtIGZhdmljb24uaWNvIChmYXZpY29uIGZpbGUpXG4gICAgICovXG4gICAgXCIvKCg/IWFwaXxpY29ufGltYWdlc3xfbmV4dC9zdGF0aWN8X25leHQvaW1hZ2V8ZmF2aWNvbi5pY28pLiopXCIsXG4gIF0sXG59O1xuIl0sIm5hbWVzIjpbInZlcmlmeUF1dGgiLCJOZXh0UmVzcG9uc2UiLCJMb2JieVNlcnZpY2UiLCJtaWRkbGV3YXJlIiwicmVxIiwiY3J1bmNoeVRva2VuIiwiY29va2llcyIsImdldCIsInZhbHVlIiwicmVmcmVzaFRva2VuIiwiY2hhbmdlQ29va2llcyIsInZlcmlmaWVkVG9rZW4iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJuZXh0VXJsIiwicGF0aG5hbWUiLCJ0d29GYWN0b3JBdXRoIiwicmVkaXJlY3QiLCJVUkwiLCJ1cmwiLCJzdGFydHNXaXRoIiwiY3VycmVudFRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsIkRhdGUiLCJub3ciLCJleHAiLCJyZXMiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJvayIsIkVycm9yIiwiZGF0YSIsImpzb24iLCJhY2Nlc3NfdG9rZW4iLCJyZWZyZXNoX3Rva2VuIiwiZXJyb3IiLCJsb2dpbiIsInJlc3BvbnNlIiwic2V0IiwiaHR0cE9ubHkiLCJzYW1lU2l0ZSIsInBhdGgiLCJsb2JieVNlcnZpY2UiLCJpc0luR2FtZSIsInRoZW4iLCJyZXQiLCJzdWNjZXNzIiwibmV4dCIsImNvbmZpZyIsIm1hdGNoZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});